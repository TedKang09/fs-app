<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenDart API ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: white;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #ffe6e6;
            border-color: #ff9999;
            color: #cc0000;
        }

        .success {
            background: #e6ffe6;
            border-color: #99ff99;
            color: #006600;
        }

        .company-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .company-item:last-child {
            border-bottom: none;
        }

        .company-info {
            flex: 1;
        }

        .company-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .company-details {
            font-size: 0.9em;
            color: #666;
        }

        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .download-btn:hover {
            background: #218838;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .highlight {
            animation: highlight 1s ease-in-out;
        }

        @keyframes highlight {
            0% { background-color: #fff3cd; }
            50% { background-color: #ffeaa7; }
            100% { background-color: transparent; }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #000;
        }

        .report-detail {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
            min-width: 120px;
        }

        .detail-value {
            color: #333;
            flex: 1;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š OpenDart API ëŒ€ì‹œë³´ë“œ</h1>
            <p>ê³µì‹œì •ë³´ APIë¥¼ í†µí•œ ê¸°ì—… ì •ë³´ ì¡°íšŒ</p>
        </div>

        <div class="content">
            <!-- í†µê³„ ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ“ˆ ì‹¤ì‹œê°„ í†µê³„</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalCompanies">-</div>
                        <div class="stat-label">ì´ ê¸°ì—… ìˆ˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayReports">-</div>
                        <div class="stat-label">ì˜¤ëŠ˜ ê³µì‹œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="apiStatus">âœ…</div>
                        <div class="stat-label">API ìƒíƒœ</div>
                    </div>
                </div>
            </div>

            <!-- ê¸°ì—… ëª©ë¡ ì¡°íšŒ -->
            <div class="section">
                <h2>ğŸ¢ ê¸°ì—… ëª©ë¡ ì¡°íšŒ</h2>
                
                <!-- ê¸°ì—…ëª… ê²€ìƒ‰ -->
                <div class="form-group">
                    <label for="companyName">ê¸°ì—…ëª… ê²€ìƒ‰:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="companyName" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì, SKí•˜ì´ë‹‰ìŠ¤" style="flex: 1;">
                        <button class="btn" onclick="searchByCompanyName()" style="white-space: nowrap;">ğŸ” ê¸°ì—…ëª… ê²€ìƒ‰</button>
                        <button class="btn" onclick="testButtonClick()" style="white-space: nowrap; background: #dc3545;">ğŸ§ª í…ŒìŠ¤íŠ¸</button>
                    </div>
                    <small style="color: #666; font-size: 0.9em;">
                        ğŸ’¡ ê¸°ì—…ëª…ì„ ì…ë ¥í•˜ì—¬ í•´ë‹¹ ê¸°ì—…ì˜ ê³µì‹œ ì •ë³´ë¥¼ ë°”ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </small>
                </div>
                
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">
                
                <!-- ê¸°ì¡´ ê²€ìƒ‰ ì˜µì…˜ -->
                <div class="form-group">
                    <label for="startDate">ì‹œì‘ì¼:</label>
                    <input type="date" id="startDate" value="2024-05-01">
                </div>
                <div class="form-group">
                    <label for="endDate">ì¢…ë£Œì¼:</label>
                    <input type="date" id="endDate" value="2024-07-31">
                </div>
                <div class="form-group">
                    <label for="corpClass">ê¸°ì—… ë¶„ë¥˜:</label>
                    <select id="corpClass">
                        <option value="">ì „ì²´</option>
                        <option value="Y">ëŒ€í‘œê³µì‹œì‚¬ì‹¤</option>
                        <option value="K">ì£¼ìš”ì‚¬í•­ë³´ê³ ì„œ</option>
                        <option value="A">ì •ê¸°ê³µì‹œ</option>
                        <option value="T">ê³µì •ê³µì‹œ</option>
                    </select>
                </div>
                <div class="form-group">
                    <small style="color: #666; font-size: 0.9em;">
                        âš ï¸ OpenDart API ì œí•œ: corp_codeê°€ ì—†ëŠ” ê²½ìš° ê²€ìƒ‰ ê¸°ê°„ì€ 3ê°œì›”ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </small>
                </div>
                <button class="btn" onclick="searchCompanies()">ğŸ” ê¸°ì—… ê²€ìƒ‰</button>
                <button class="btn" onclick="downloadCSV()">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn" onclick="downloadJSON()">ğŸ“¥ JSON ë‹¤ìš´ë¡œë“œ</button>
                
                <div id="companyResult" class="result" style="display: none;"></div>
            </div>

            <!-- ê³µì‹œ ì •ë³´ ì¡°íšŒ -->
            <div class="section">
                <h2>ğŸ“‹ ê³µì‹œ ì •ë³´ ì¡°íšŒ</h2>
                <div class="form-group">
                    <label for="corpCode">ê¸°ì—… ì½”ë“œ:</label>
                    <input type="text" id="corpCode" placeholder="ì˜ˆ: 00126380">
                </div>
                <div class="form-group">
                    <label for="bgnDe">ì‹œì‘ì¼:</label>
                    <input type="date" id="bgnDe" value="2024-05-01">
                </div>
                <div class="form-group">
                    <label for="endDe">ì¢…ë£Œì¼:</label>
                    <input type="date" id="endDe" value="2024-07-31">
                </div>
                <button class="btn" onclick="searchReports()">ğŸ“Š ê³µì‹œ ì¡°íšŒ</button>
                
                <div id="reportResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- ê³µì‹œ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“‹ ê³µì‹œ ìƒì„¸ ì •ë³´</div>
                <span class="close" onclick="closeReportModal()">&times;</span>
            </div>
            <div id="modalContent">
                <!-- ëª¨ë‹¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '447fcb4de167afbabb21ed7ded674931a89ad0b3';
        const PROXY_URL = 'http://localhost:3001';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', async () => {
            await checkApiStatus();
            await loadTodayStats();
            setDefaultDateRange();
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            const modal = document.getElementById('reportModal');
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeReportModal();
                }
            });
            
            // Enter í‚¤ë¡œ ê¸°ì—…ëª… ê²€ìƒ‰
            document.getElementById('companyName').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    searchByCompanyName();
                }
            });
            
            // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í™•ì¸
            const searchButton = document.querySelector('button[onclick="searchByCompanyName()"]');
            if (searchButton) {
                searchButton.addEventListener('click', function(event) {
                    console.log('ğŸ”˜ ê¸°ì—…ëª… ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ë¨');
                    event.preventDefault();
                    searchByCompanyName();
                });
            }
        });

        // ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testButtonClick() {
            console.log('ğŸ”˜ ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸ ì„±ê³µ');
            alert('ë²„íŠ¼ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!');
        }

        // ê¸°ë³¸ ë‚ ì§œ ë²”ìœ„ ì„¤ì • (3ê°œì›”)
        function setDefaultDateRange() {
            const today = new Date();
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(today.getMonth() - 3);
            
            const formatDate = (date) => {
                return date.toISOString().split('T')[0];
            };
            
            document.getElementById('startDate').value = formatDate(threeMonthsAgo);
            document.getElementById('endDate').value = formatDate(today);
            document.getElementById('bgnDe').value = formatDate(threeMonthsAgo);
            document.getElementById('endDe').value = formatDate(today);
        }

        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê³µí†µ í•¨ìˆ˜
        function downloadFile(content, fileName, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // API ìƒíƒœ í™•ì¸
        async function checkApiStatus() {
            try {
                const response = await fetch(`${PROXY_URL}/api/list.json?crtfc_key=${API_KEY}&bgn_de=20240101&end_de=20240101&page_no=1&page_count=1`);
                const data = await response.json();
                
                if (data.status === '000') {
                    document.getElementById('apiStatus').textContent = 'âœ…';
                    document.getElementById('apiStatus').style.color = '#28a745';
                } else {
                    document.getElementById('apiStatus').textContent = 'âŒ';
                    document.getElementById('apiStatus').style.color = '#dc3545';
                }
            } catch (error) {
                document.getElementById('apiStatus').textContent = 'âŒ';
                document.getElementById('apiStatus').style.color = '#dc3545';
            }
        }

        // ì˜¤ëŠ˜ í†µê³„ ë¡œë“œ
        async function loadTodayStats() {
            try {
                const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
                const response = await fetch(`${PROXY_URL}/api/list.json?crtfc_key=${API_KEY}&bgn_de=${today}&end_de=${today}&page_no=1&page_count=100`);
                const data = await response.json();
                
                if (data.status === '000') {
                    document.getElementById('todayReports').textContent = data.list ? data.list.length : 0;
                }
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ê¸°ì—… ëª©ë¡ ê²€ìƒ‰
        async function searchCompanies() {
            const startDate = document.getElementById('startDate').value.replace(/-/g, '');
            const endDate = document.getElementById('endDate').value.replace(/-/g, '');
            const corpClass = document.getElementById('corpClass').value;
            
            // ê²€ìƒ‰ ê¸°ê°„ ì œí•œ í™•ì¸ (3ê°œì›”)
            const start = new Date(document.getElementById('startDate').value);
            const end = new Date(document.getElementById('endDate').value);
            const monthsDiff = (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());
            
            if (monthsDiff > 3) {
                alert('âš ï¸ OpenDart API ì œí•œì‚¬í•­\n\ncorp_codeê°€ ì—†ëŠ” ê²½ìš° ê²€ìƒ‰ ê¸°ê°„ì€ 3ê°œì›”ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\nê²€ìƒ‰ ê¸°ê°„ì„ 3ê°œì›” ì´ë‚´ë¡œ ì¡°ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const resultDiv = document.getElementById('companyResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">ğŸ” ê¸°ì—… ì •ë³´ë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</div>';
            resultDiv.className = 'result';

            try {
                let url = `${PROXY_URL}/api/list.json?crtfc_key=${API_KEY}&bgn_de=${startDate}&end_de=${endDate}&page_no=1&page_count=50`;
                if (corpClass) {
                    url += `&corp_class=${corpClass}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.status === '000' && data.list) {
                    displayCompanies(data.list);
                    document.getElementById('totalCompanies').textContent = data.list.length;
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ ê²€ìƒ‰ ì‹¤íŒ¨: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</div>`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}</div>`;
                resultDiv.className = 'result error';
            }
        }

        // ê¸°ì—… ëª©ë¡ í‘œì‹œ
        function displayCompanies(companies) {
            const resultDiv = document.getElementById('companyResult');
            
            if (companies.length === 0) {
                resultDiv.innerHTML = '<div class="success">ğŸ“­ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                resultDiv.className = 'result success';
                window.lastSearchData = [];
                return;
            }

            // ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ë‹¤ìš´ë¡œë“œìš©)
            window.lastSearchData = companies;

            let html = `<h3>ğŸ“Š ê²€ìƒ‰ ê²°ê³¼ (${companies.length}ê°œ)</h3>`;
            
            companies.forEach(company => {
                html += `
                    <div class="company-item">
                        <div class="company-info">
                            <div class="company-name">${company.corp_name || 'N/A'}</div>
                            <div class="company-details">
                                ì½”ë“œ: ${company.corp_code || 'N/A'} | 
                                ë¶„ë¥˜: ${company.corp_class || 'N/A'} | 
                                ê³µì‹œì¼: ${company.rcept_dt || 'N/A'}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="download-btn" onclick="viewReport('${company.corp_code}', '${company.rcept_no}')">
                                ğŸ“„ ë³´ê¸°
                            </button>
                            <button class="download-btn" style="background: #17a2b8;" onclick="searchCompanyReports('${company.corp_code}', '${company.corp_name || ''}')">
                                ğŸ“‹ ê³µì‹œì¡°íšŒ
                            </button>
                        </div>
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
            resultDiv.className = 'result success';
        }

        // ê¸°ì—…ëª…ìœ¼ë¡œ ê²€ìƒ‰
        async function searchByCompanyName() {
            const companyName = document.getElementById('companyName').value.trim();
            if (!companyName) {
                alert('ê²€ìƒ‰í•  ê¸°ì—…ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('ğŸ” ê¸°ì—…ëª… ê²€ìƒ‰ ì‹œì‘:', companyName);

            const resultDiv = document.getElementById('companyResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">ğŸ” ê¸°ì—… ì •ë³´ë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</div>';
            resultDiv.className = 'result';

            try {
                // ì²« ë²ˆì§¸ ë°©ë²•: corp_name íŒŒë¼ë¯¸í„°ë¡œ ê²€ìƒ‰
                let url = `${PROXY_URL}/api/list.json?crtfc_key=${API_KEY}&corp_name=${encodeURIComponent(companyName)}&page_no=1&page_count=50`;
                console.log('ğŸ“¡ API ìš”ì²­ URL (ë°©ë²•1):', url);
                
                let response = await fetch(url);
                console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', response.status);
                
                let data = await response.json();
                console.log('ğŸ“Š ì‘ë‹µ ë°ì´í„°:', data);

                // ì²« ë²ˆì§¸ ë°©ë²•ì´ ì‹¤íŒ¨í•˜ë©´ ë‘ ë²ˆì§¸ ë°©ë²• ì‹œë„
                if (data.status !== '000' || !data.list || data.list.length === 0) {
                    console.log('ğŸ”„ ì²« ë²ˆì§¸ ë°©ë²• ì‹¤íŒ¨, ë‘ ë²ˆì§¸ ë°©ë²• ì‹œë„');
                    
                    // ë‘ ë²ˆì§¸ ë°©ë²•: ì¼ë°˜ ê²€ìƒ‰ìœ¼ë¡œ ì‹œë„
                    const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
                    url = `${PROXY_URL}/api/list.json?crtfc_key=${API_KEY}&bgn_de=${today}&end_de=${today}&page_no=1&page_count=100`;
                    
                    response = await fetch(url);
                    data = await response.json();
                    
                    if (data.status === '000' && data.list) {
                        // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ê¸°ì—…ëª… í•„í„°ë§
                        const filteredList = data.list.filter(item => 
                            item.corp_name && item.corp_name.includes(companyName)
                        );
                        
                        if (filteredList.length > 0) {
                            console.log('âœ… í•„í„°ë§ ê²€ìƒ‰ ì„±ê³µ, ê²°ê³¼ ìˆ˜:', filteredList.length);
                            displayCompanies(filteredList);
                            document.getElementById('totalCompanies').textContent = filteredList.length;
                            return;
                        }
                    }
                } else {
                    console.log('âœ… ê²€ìƒ‰ ì„±ê³µ, ê²°ê³¼ ìˆ˜:', data.list.length);
                    displayCompanies(data.list);
                    document.getElementById('totalCompanies').textContent = data.list.length;
                    return;
                }

                // ëª¨ë“  ë°©ë²•ì´ ì‹¤íŒ¨í•œ ê²½ìš°
                console.error('âŒ ëª¨ë“  ê²€ìƒ‰ ë°©ë²• ì‹¤íŒ¨');
                resultDiv.innerHTML = `<div class="error">âŒ ê²€ìƒ‰ ì‹¤íŒ¨: "${companyName}"ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
                resultDiv.className = 'result error';
                
            } catch (error) {
                console.error('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
                resultDiv.innerHTML = `<div class="error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}</div>`;
                resultDiv.className = 'result error';
            }
        }

        // ê¸°ì—…ì˜ ëª¨ë“  ê³µì‹œ ì¡°íšŒ
        async function searchCompanyReports(corpCode, corpName) {
            // ê¸°ì—…ì½”ë“œë¥¼ ê³µì‹œì •ë³´ ì¡°íšŒ ì„¹ì…˜ì— ìë™ ì…ë ¥
            document.getElementById('corpCode').value = corpCode;
            
            // ê³µì‹œì •ë³´ ì¡°íšŒ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('corpCode').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ ì¶”ê°€
            const corpCodeInput = document.getElementById('corpCode');
            corpCodeInput.classList.add('highlight');
            setTimeout(() => {
                corpCodeInput.classList.remove('highlight');
            }, 1000);
            
            // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ ì£¼ê¸°
            setTimeout(() => {
                corpCodeInput.focus();
            }, 500);
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            const message = `âœ… "${corpName}" ê¸°ì—…ì½”ë“œê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“‹ ë‹¤ìŒ ë‹¨ê³„:\n1. í•„ìš”ì‹œ ë‚ ì§œ ë²”ìœ„ë¥¼ ì¡°ì •í•˜ì„¸ìš”\n2. "ğŸ“Š ê³µì‹œ ì¡°íšŒ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”\n3. í•´ë‹¹ ê¸°ì—…ì˜ ëª¨ë“  ê³µì‹œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”`;
            alert(message);
        }

        // ê³µì‹œ ì •ë³´ ì¡°íšŒ
        async function searchReports() {
            const corpCode = document.getElementById('corpCode').value;
            const bgnDe = document.getElementById('bgnDe').value.replace(/-/g, '');
            const endDe = document.getElementById('endDe').value.replace(/-/g, '');
            
            if (!corpCode) {
                alert('ê¸°ì—… ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const resultDiv = document.getElementById('reportResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">ğŸ“Š ê³µì‹œ ì •ë³´ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...</div>';
            resultDiv.className = 'result';

            try {
                const url = `${PROXY_URL}/api/list.json?crtfc_key=${API_KEY}&corp_code=${corpCode}&bgn_de=${bgnDe}&end_de=${endDe}&page_no=1&page_count=50`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.status === '000' && data.list) {
                    displayReports(data.list);
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ ì¡°íšŒ ì‹¤íŒ¨: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</div>`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}</div>`;
                resultDiv.className = 'result error';
            }
        }

        // ê³µì‹œ ì •ë³´ í‘œì‹œ
        function displayReports(reports) {
            const resultDiv = document.getElementById('reportResult');
            
            if (reports.length === 0) {
                resultDiv.innerHTML = '<div class="success">ğŸ“­ ê³µì‹œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                resultDiv.className = 'result success';
                return;
            }

            let html = `<h3>ğŸ“‹ ê³µì‹œ ì •ë³´ (${reports.length}ê°œ)</h3>`;
            
            reports.forEach(report => {
                html += `
                    <div class="company-item">
                        <div class="company-info">
                            <div class="company-name">${report.report_nm || 'N/A'}</div>
                            <div class="company-details">
                                ì ‘ìˆ˜ë²ˆí˜¸: ${report.rcept_no || 'N/A'} | 
                                ì ‘ìˆ˜ì¼: ${report.rcept_dt || 'N/A'} | 
                                ì œì¶œì¸: ${report.flr_nm || 'N/A'}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="download-btn" onclick="viewReportDetail('${report.corp_code}', '${report.rcept_no}', '${report.report_nm || ''}')">
                                ğŸ“„ ìƒì„¸ë³´ê¸°
                            </button>
                            <button class="download-btn" style="background: #17a2b8;" onclick="openDartWebsite('${report.corp_code}', '${report.rcept_no}')">
                                ğŸŒ OpenDart
                            </button>
                        </div>
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
            resultDiv.className = 'result success';
        }

        // ê³µì‹œ ìƒì„¸ ë³´ê¸°
        function viewReport(corpCode, rceptNo) {
            // ê¸°ì—…ì½”ë“œë¥¼ ê³µì‹œì •ë³´ ì¡°íšŒ ì„¹ì…˜ì— ìë™ ì…ë ¥
            const corpCodeInput = document.getElementById('corpCode');
            corpCodeInput.value = corpCode;
            
            // ê³µì‹œì •ë³´ ì¡°íšŒ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            corpCodeInput.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ ì¶”ê°€
            corpCodeInput.classList.add('highlight');
            setTimeout(() => {
                corpCodeInput.classList.remove('highlight');
            }, 1000);
            
            // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ ì£¼ê¸°
            setTimeout(() => {
                corpCodeInput.focus();
            }, 500);
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (ë” ì¹œí™”ì ì¸ ë©”ì‹œì§€)
            const message = `âœ… ê¸°ì—…ì½”ë“œ "${corpCode}"ê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“‹ ë‹¤ìŒ ë‹¨ê³„:\n1. í•„ìš”ì‹œ ë‚ ì§œ ë²”ìœ„ë¥¼ ì¡°ì •í•˜ì„¸ìš”\n2. "ğŸ“Š ê³µì‹œ ì¡°íšŒ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”\n3. í•´ë‹¹ ê¸°ì—…ì˜ ìƒì„¸ ê³µì‹œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”`;
            alert(message);
        }

        // ê³µì‹œ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
        function viewReportDetail(corpCode, rceptNo, reportName) {
            const modal = document.getElementById('reportModal');
            const modalContent = document.getElementById('modalContent');
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            modalContent.innerHTML = '<div class="loading">ğŸ“Š ê³µì‹œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            modal.style.display = 'block';
            
            // ê³µì‹œ ìƒì„¸ ì •ë³´ ì¡°íšŒ
            fetchReportDetail(corpCode, rceptNo, reportName);
        }

        // ê³µì‹œ ìƒì„¸ ì •ë³´ ì¡°íšŒ
        async function fetchReportDetail(corpCode, rceptNo, reportName) {
            try {
                // OpenDart APIì—ì„œ ê³µì‹œ ìƒì„¸ ì •ë³´ ì¡°íšŒ
                const url = `${PROXY_URL}/api/view.json?crtfc_key=${API_KEY}&rcept_no=${rceptNo}`;
                const response = await fetch(url);
                const data = await response.json();
                
                displayReportDetail(data, corpCode, rceptNo, reportName);
            } catch (error) {
                // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì •ë³´ë¡œ í‘œì‹œ
                displayReportDetail(null, corpCode, rceptNo, reportName);
            }
        }

        // ê³µì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function displayReportDetail(data, corpCode, rceptNo, reportName) {
            const modalContent = document.getElementById('modalContent');
            
            let html = `
                <div class="report-detail">
                    <div class="detail-row">
                        <div class="detail-label">ğŸ“‹ ê³µì‹œëª…:</div>
                        <div class="detail-value">${reportName || 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">ğŸ¢ ê¸°ì—…ì½”ë“œ:</div>
                        <div class="detail-value">${corpCode || 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">ğŸ“ ì ‘ìˆ˜ë²ˆí˜¸:</div>
                        <div class="detail-value">${rceptNo || 'N/A'}</div>
                    </div>
            `;
            
            if (data && data.status === '000') {
                // APIì—ì„œ ë°›ì€ ìƒì„¸ ì •ë³´ ì¶”ê°€
                html += `
                    <div class="detail-row">
                        <div class="detail-label">ğŸ“… ì ‘ìˆ˜ì¼:</div>
                        <div class="detail-value">${data.rcept_dt || 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">ğŸ‘¤ ì œì¶œì¸:</div>
                        <div class="detail-value">${data.flr_nm || 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">ğŸ“Š ê³µì‹œë¶„ë¥˜:</div>
                        <div class="detail-value">${data.report_nm || 'N/A'}</div>
                    </div>
                `;
            }
            
            html += `
                </div>
                <div class="action-buttons">
                    <button class="action-btn btn-primary" onclick="openDartWebsite('${corpCode}', '${rceptNo}')">
                        ğŸŒ OpenDartì—ì„œ ë³´ê¸°
                    </button>
                    <button class="action-btn btn-secondary" onclick="copyReportInfo('${corpCode}', '${rceptNo}', '${reportName}')">
                        ğŸ“‹ ì •ë³´ ë³µì‚¬
                    </button>
                    <button class="action-btn btn-success" onclick="downloadReportPDF('${corpCode}', '${rceptNo}')">
                        ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            `;
            
            modalContent.innerHTML = html;
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeReportModal() {
            document.getElementById('reportModal').style.display = 'none';
        }

        // OpenDart ì›¹ì‚¬ì´íŠ¸ ì—´ê¸°
        function openDartWebsite(corpCode, rceptNo) {
            const url = `https://dart.fss.or.kr/dsaf001/main.do?rcpNo=${rceptNo}`;
            window.open(url, '_blank');
        }

        // ê³µì‹œ ì •ë³´ ë³µì‚¬
        function copyReportInfo(corpCode, rceptNo, reportName) {
            const info = `ê³µì‹œëª…: ${reportName}\nê¸°ì—…ì½”ë“œ: ${corpCode}\nì ‘ìˆ˜ë²ˆí˜¸: ${rceptNo}\nOpenDart ë§í¬: https://dart.fss.or.kr/dsaf001/main.do?rcpNo=${rceptNo}`;
            
            navigator.clipboard.writeText(info).then(() => {
                alert('âœ… ê³µì‹œ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                // í´ë¦½ë³´ë“œ APIê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê²½ìš°
                const textArea = document.createElement('textarea');
                textArea.value = info;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… ê³µì‹œ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        // PDF ë‹¤ìš´ë¡œë“œ (OpenDart ë§í¬ë¡œ ì´ë™)
        function downloadReportPDF(corpCode, rceptNo) {
            const url = `https://dart.fss.or.kr/dsaf001/main.do?rcpNo=${rceptNo}`;
            alert('ğŸ“„ PDF ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•´ OpenDart ì›¹ì‚¬ì´íŠ¸ë¡œ ì´ë™í•©ë‹ˆë‹¤.\n\nOpenDartì—ì„œ "ì›ë¬¸ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ PDFë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.');
            window.open(url, '_blank');
        }

        // CSV ë‹¤ìš´ë¡œë“œ
        function downloadCSV() {
            const resultDiv = document.getElementById('companyResult');
            if (!resultDiv.innerHTML.includes('company-item')) {
                alert('ë¨¼ì € ê¸°ì—…ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê²€ìƒ‰ëœ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
            if (!window.lastSearchData || !window.lastSearchData.length) {
                alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê¸°ì—…ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // CSV í—¤ë” ìƒì„±
            const headers = ['ê¸°ì—…ëª…', 'ê¸°ì—…ì½”ë“œ', 'ë¶„ë¥˜', 'ê³µì‹œì¼', 'ì ‘ìˆ˜ë²ˆí˜¸', 'ì œì¶œì¸'];
            const csvContent = [
                headers.join(','),
                ...window.lastSearchData.map(item => [
                    `"${item.corp_name || ''}"`,
                    item.corp_code || '',
                    item.corp_class || '',
                    item.rcept_dt || '',
                    item.rcept_no || '',
                    `"${item.flr_nm || ''}"`
                ].join(','))
            ].join('\n');
            
            // íŒŒì¼ëª… ìƒì„±
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const fileName = `opendart_companies_${startDate}_${endDate}.csv`;
            
            // CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            downloadFile(csvContent, fileName, 'text/csv');
        }

        // JSON ë‹¤ìš´ë¡œë“œ
        function downloadJSON() {
            const resultDiv = document.getElementById('companyResult');
            if (!resultDiv.innerHTML.includes('company-item')) {
                alert('ë¨¼ì € ê¸°ì—…ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê²€ìƒ‰ëœ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
            if (!window.lastSearchData || !window.lastSearchData.length) {
                alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê¸°ì—…ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // JSON ë°ì´í„° ì¤€ë¹„
            const jsonData = {
                searchInfo: {
                    startDate: document.getElementById('startDate').value,
                    endDate: document.getElementById('endDate').value,
                    corpClass: document.getElementById('corpClass').value,
                    totalCount: window.lastSearchData.length,
                    exportDate: new Date().toISOString()
                },
                companies: window.lastSearchData
            };
            
            // íŒŒì¼ëª… ìƒì„±
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const fileName = `opendart_companies_${startDate}_${endDate}.json`;
            
            // JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            downloadFile(JSON.stringify(jsonData, null, 2), fileName, 'application/json');
        }
    </script>
</body>
</html> 